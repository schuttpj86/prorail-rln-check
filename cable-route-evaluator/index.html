<!doctype html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:;base64,=" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProRail Cable Route Evaluator</title>
  </head>
  <body>
    <calcite-shell>
      <!-- Top Navigation Bar -->
      <calcite-navigation slot="header">
        <calcite-navigation-logo 
          slot="logo" 
          heading="ProRail HV Connection Route Evaluator"
          description="EMC Compliance Analysis Tool">
        </calcite-navigation-logo>
        
        <!-- Language toggle and actions in header -->
        <div slot="content-end" style="display: flex; gap: 8px; align-items: center; padding-right: 16px;">
          <button class="header-btn" id="lang-toggle" title="Switch Language / Taal Wijzigen">
            🇳🇱 NL
          </button>
          <button class="header-btn" id="help-btn" data-i18n-title="Help & Documentation" title="Help & Documentation">
            <span data-i18n="help">Help</span>
          </button>
          <button class="header-btn" id="settings-btn" data-i18n-title="Settings" title="Settings">
            <span data-i18n="settings">Settings</span>
          </button>
        </div>
      </calcite-navigation>

      <!-- Left Collapsible Panel with Action Bar -->
      <calcite-shell-panel 
        slot="panel-start" 
        position="start"
        width-scale="m"
        collapsible
        display-mode="float"
        id="leftPanel">
        
        <calcite-action-bar slot="action-bar" id="actionBar">
          <calcite-action 
            text="HV Connection Routes" 
            icon="map-pin" 
            id="action-routes"
            active>
          </calcite-action>
          <calcite-action 
            text="Tools" 
            icon="measure" 
            id="action-tools">
          </calcite-action>
          <calcite-action 
            text="Layers" 
            icon="layers" 
            id="action-layers">
          </calcite-action>
          
          <!-- Collapse button at bottom -->
          <calcite-action 
            slot="actions-end"
            text="Collapse panel" 
            icon="chevron-left" 
            id="collapse-left"
            scale="s">
          </calcite-action>
        </calcite-action-bar>

        <!-- Routes Panel Content -->
        <calcite-panel 
          heading="High Voltage Connection Routes" 
          id="panel-routes">
            
          <!-- Compact Create Route Button with Counter -->
          <div id="routeList" class="panel-content-inner" style="padding: 16px 16px; overflow-x: hidden;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;">
              <!-- Create Route Button - More Compact -->
              <button id="no-routes-message" style="
                padding: 8px 12px;
                font-size: 0.8125rem; 
                font-weight: 600;
                color: white; 
                background: #1a1a1a;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
                white-space: nowrap;
              "
              onmouseover="this.style.background='#000';"
              onmouseout="this.style.background='#1a1a1a';">
                <span style="font-size: 0.9rem;">➕</span>
                <span data-i18n="clickToCreateRoute">Route</span>
              </button>
              
              <!-- Import Route Button -->
              <button id="import-route-btn" 
                onclick="document.getElementById('import-file-input').click()"
                style="
                padding: 8px 12px;
                font-size: 0.8125rem; 
                font-weight: 500;
                color: #1a1a1a; 
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
                white-space: nowrap;
              "
              onmouseover="this.style.background='#f8f9fa'; this.style.borderColor='#000';"
              onmouseout="this.style.background='white'; this.style.borderColor='#e0e0e0';"
              title="Import route(s) from JSON file">
                <span style="font-size: 0.9rem;">📂</span>
                <span>Import</span>
              </button>
              
              <!-- Hidden file input -->
              <input type="file" 
                     id="import-file-input" 
                     accept=".json,application/json"
                     style="display: none;"
                     onchange="handleImportFile(event)" />
              
              <!-- Export All Routes Button -->
              <button id="export-all-routes-btn" 
                onclick="exportAllRoutesJSON()"
                style="
                padding: 8px 12px;
                font-size: 0.8125rem; 
                font-weight: 500;
                color: #1a1a1a; 
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
                white-space: nowrap;
              "
              onmouseover="this.style.background='#f8f9fa'; this.style.borderColor='#000';"
              onmouseout="this.style.background='white'; this.style.borderColor='#e0e0e0';"
              title="Export all routes to a single JSON file">
                <span style="font-size: 0.9rem;">💾</span>
                <span>Export All</span>
              </button>
              
              <!-- Generate Comparative Report Button -->
              <button id="generate-report-btn" 
                onclick="exportComparativeReport()"
                style="
                padding: 8px 12px;
                font-size: 0.8125rem; 
                font-weight: 500;
                color: white; 
                background: #2196f3;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s ease;
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
                white-space: nowrap;
              "
              onmouseover="this.style.background='#1976d2';"
              onmouseout="this.style.background='#2196f3';"
              title="Generate professional comparative evaluation report for all routes (Markdown)">
                <span style="font-size: 0.9rem;">📄</span>
                <span>Report</span>
              </button>
              
              <!-- Route Counter - Inline with flex -->
              <div style="
                font-size: 0.75rem;
                color: #999;
                font-weight: 500;
                flex-shrink: 0;
                white-space: nowrap;
              ">
                <span id="route-count-text">0 routes</span>
              </div>
            </div>
            
            <div id="routes" style="display: flex; flex-direction: column; gap: 8px; overflow-x: hidden;"></div>
          </div>
        </calcite-panel>

        <!-- Tools Panel Content (hidden by default) -->
        <calcite-panel 
          heading="Tools" 
          id="panel-tools"
          hidden>
          <div class="panel-content-inner" style="padding: 20px;">
            <!-- Measurement Section -->
            <div class="tool-section">
              <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 12px; color: #000;">Measurement Tool</h3>
              <div id="measurement-status" class="measurement-status" style="margin-bottom: 12px;">
                Click "Measure Distance" to start measuring
              </div>
              <button id="start-measurement" class="measurement-btn measurement-btn-primary" title="Click to add points, right-click to finish" style="width: 100%; margin-bottom: 8px;">
                📏 Measure Distance
              </button>
              <button id="clear-measurement" class="measurement-btn measurement-btn-secondary" title="Clear all measurements from the map" style="width: 100%;">
                🧹 Clear Measurements
              </button>
            </div>
          </div>
        </calcite-panel>

        <!-- Layers Panel Content (hidden by default) -->
        <calcite-panel 
          heading="Layers" 
          id="panel-layers"
          hidden>
          <div class="panel-content-inner">
            <!-- Layer list widget will be inserted here by JavaScript -->
            <div id="layer-list-container"></div>
          </div>
        </calcite-panel>

      </calcite-shell-panel>

      <!-- Map Container -->
      <div id="app" style="display: flex; height: 100%; width: 100%; flex: 1;">
        <div id="viewDiv" style="width: 100%; height: 100%; position: relative;">
        
        <!-- Floating button to reopen results panel when collapsed -->
        <button id="reopen-results-btn" style="
          position: absolute;
          top: 16px;
          right: 16px;
          z-index: 100;
          background: white;
          border: 1px solid #e5e5e5;
          border-radius: 6px;
          padding: 10px;
          cursor: pointer;
          display: none;
          align-items: center;
          justify-content: center;
          color: #1a1a1a;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          transition: all 0.2s ease;
          width: 40px;
          height: 40px;
        "
        onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; this.style.transform='translateY(-1px)'; this.style.background='#f8f9fa'"
        onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'; this.style.background='white'"
        title="Open evaluation results panel">
          <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2 2h12v12H2V2zm2 2v8h8V4H4zm1 1h6v1H5V5zm0 2h6v1H5V7zm0 2h4v1H5V9z"/>
          </svg>
        </button>
        
        <!-- Coordinate Display Widget (bottom center) -->
        <div id="coordinate-display" style="
          position: absolute;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(255, 255, 255, 0.95);
          border: 1px solid #e5e5e5;
          border-radius: 6px;
          padding: 8px 16px;
          z-index: 100;
          font-size: 0.875rem;
          font-weight: 500;
          color: #333;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          font-family: 'Courier New', monospace;
          white-space: nowrap;
        ">
          <span style="color: #666; margin-right: 12px;">X:</span>
          <span id="coord-x" style="color: #000; min-width: 80px; display: inline-block;">-</span>
          <span style="color: #666; margin: 0 12px 0 16px;">Y:</span>
          <span id="coord-y" style="color: #000; min-width: 80px; display: inline-block;">-</span>
        </div>
        
        <!-- Welcome Message -->
        <div id="welcome-message" style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 32px 40px;
          border-radius: 8px;
          box-shadow: 0 4px 24px rgba(0,0,0,0.12);
          z-index: 9998;
          max-width: 600px;
          border: 1px solid #e5e5e5;
        ">
          <h2 style="margin: 0 0 20px 0; color: #000000; font-size: 1.5rem; font-weight: 600;" data-i18n="welcomeTitle">
            Welcome to ProRail Cable Route Evaluator
          </h2>
          
          <div style="margin-bottom: 24px; line-height: 1.6; color: #333333;">
            <p style="margin: 0 0 12px 0; font-size: 0.9375rem;" data-i18n="welcomeDescription">
              This tool helps you design and evaluate cable routes along railway infrastructure for compliance with EMC (Electromagnetic Compatibility) requirements.
            </p>
            
            <div style="margin: 0 0 16px 0; padding: 12px 16px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px;">
              <p style="margin: 0; font-size: 0.8125rem; color: #2e7d32; font-weight: 500;">
                ✅ <span data-i18n="updatedStandard"><strong>Updated to RLN00398 Version 002 (2020)</strong> – Now includes the latest ProRail EMC requirements</span>
              </p>
            </div>
            
            <h3 style="margin: 0 0 12px 0; font-size: 1rem; font-weight: 600; color: #000000;" data-i18n="howToUse">
              How to Use:
            </h3>
            
            <div style="margin-bottom: 20px;">
              <p style="margin: 0 0 8px 0; font-weight: 600; font-size: 0.875rem;" data-i18n="drawingRoutesTitle">
                📍 Drawing Routes:
              </p>
              <ul style="margin: 0 0 12px 0; padding-left: 24px; font-size: 0.875rem; color: #555555;">
                <li data-i18n="drawingRoutesStep1">Click the <strong>➕ button</strong> in the top-left Routes panel</li>
                <li data-i18n="drawingRoutesStep2">Click on the map to add waypoints along your route</li>
                <li data-i18n="drawingRoutesStep3"><strong>Double-click</strong> to finish the route</li>
                <li data-i18n="drawingRoutesStep4">Hover over the ➕ button for quick tips</li>
              </ul>
              
              <p style="margin: 0 0 8px 0; font-weight: 600; font-size: 0.875rem;" data-i18n="evaluatingRoutesTitle">
                📊 Evaluating Routes:
              </p>
              <ul style="margin: 0 0 12px 0; padding-left: 24px; font-size: 0.875rem; color: #555555;">
                <li data-i18n="evaluatingRoutesStep1">After drawing, routes appear in the Routes panel</li>
                <li data-i18n="evaluatingRoutesStep2">Click Evaluate to check EMC compliance</li>
                <li data-i18n="evaluatingRoutesStep3">View detailed results and distance measurements</li>
              </ul>
              
              <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #666666; font-style: italic;" data-i18n="standardInfo">
                Based on ProRail Standard RLN00398, Version 002 (01-12-2020): EMC Requirements for High-Voltage Connections
              </p>
            </div>
          </div>
          
          <button id="close-welcome" style="
            width: 100%;
            padding: 12px 24px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
          " onmouseover="this.style.background='#1a1a1a'" onmouseout="this.style.background='#000000'" data-i18n="getStarted">
            Get Started
          </button>
        </div>
        
        <div id="map-loading" style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 40px 48px;
          border-radius: 8px;
          box-shadow: 0 4px 24px rgba(0,0,0,0.08);
          z-index: 9999;
          text-align: center;
          border: 1px solid #e5e5e5;
        ">
          <h3 style="margin: 0 0 12px 0; color: #000000; font-size: 1rem; font-weight: 500; letter-spacing: -0.01em;">Loading Map</h3>
          <p style="color: #666666; margin: 0; font-size: 0.875rem;">Please wait</p>
        </div>
        </div>
      </div>

      <!-- Right Collapsible Panel for Results -->
      <calcite-shell-panel 
        slot="panel-end" 
        position="end"
        width-scale="m"
        collapsible
        display-mode="float"
        collapsed
        id="rightPanel">
        
        <calcite-panel heading="📊 Evaluation Results" id="results-panel" description="View EMC compliance reports">
          <calcite-action 
            slot="header-actions-end"
            text="Collapse results" 
            icon="chevron-right" 
            id="collapse-right"
            scale="s">
          </calcite-action>
          
          <div id="resultsPanel" class="panel-content-inner">
            <div id="results"></div>
          </div>
        </calcite-panel>
      </calcite-shell-panel>

    </calcite-shell>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
